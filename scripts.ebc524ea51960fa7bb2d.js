"use strict";!function(t){var r=t.document,e=t.Math,i=function(t,r){var e;for(e in r)t[e]=r[e]},n=function(t,r){if(r=r||"",!t)throw new Error(r)},a=function(t,e){n("canvas"===t.nodeName.toLowerCase(),"A canvas element is excepted.");var a={width:t.width,height:t.height,useWorker:"function"==typeof Worker,workerPath:"/libs/CanvasEffects.worker.js"};i(a,e),this.width=a.width,this.height=a.height;var o=r.createElement("canvas");if(o.width=this.width,o.height=this.height,this.ctx=t.getContext("2d"),this.tmpCtx=o.getContext("2d"),a.useWorker){var s=this;this._queue=[],this.worker=new Worker(a.workerPath),this.worker.onmessage=function(t){var r=s.createImageData(s.width,s.height);if("undefined"==typeof Uint8ClampedArray)for(var e=0;e<t.data.length;e++)r.data[e]=t.data[e];else r.data.set(t.data);for(e=0;e<s._queue.length;e++)r.data=s._queue[e](r.data);s._queue=[],s.ctx.clearRect(0,0,s.width,s.height),s.ctx.putImageData(r,0,0)},this.worker.postMessage({type:"init",w:this.width,h:this.height})}};i(a.prototype,{load:function(t,r,e){"function"==typeof r&&(e=r,r=!0),r=void 0===r||r;var i=new Image,n=this;return i.onload=function(){r?(n.ctx.drawImage(this,0,0,this.width,this.height,0,0,n.width,n.height),n.tmpCtx.drawImage(this,0,0,this.width,this.height,0,0,n.width,n.height)):(n.ctx.drawImage(this,0,0,this.width,this.height),n.tmpCtx.drawImage(this,0,0,this.width,this.height)),e.call(n)},i.crossOrigin=!0,i.src=t,this},restore:function(){return this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(this.tmpCtx.canvas,0,0,this.width,this.height),this},save:function(){return this.tmpCtx.clearRect(0,0,this.width,this.height),this.tmpCtx.drawImage(this.ctx.canvas,0,0,this.width,this.height),this},toDataURL:function(){return this.ctx.canvas.toDataURL("image/png")},process:function(t){for(var r=this.ctx.getImageData(0,0,this.width,this.height),e=0;e<this.width;e++)for(var i=0;i<this.height;i++){var n=4*(i*this.width+e),a=t(r.data[n],r.data[n+1],r.data[n+2],r.data[n+3],e,i);r.data[n]=a[0],r.data[n+1]=a[1],r.data[n+2]=a[2],r.data[n+3]=a[3]}return this.ctx.clearRect(0,0,this.width,this.height),this.ctx.putImageData(r,0,0),this},getContext:function(){return this.ctx},luminance:function(t,r,e){return.2126*t+.7152*r+.0722*e},createImageData:function(t,r){return this.tmpCtx.createImageData(t,r)},toHSL:function(t,r,i){var n,a,o=e.max(t/=255,r/=255,i/=255),s=e.min(t,r,i),h=(o+s)/2;if(o===s)n=a=0;else{var u=o-s;switch(a=h>.5?u/(2-o-s):u/(o+s),o){case t:n=(r-i)/u+(r<i?6:0);break;case r:n=(i-t)/u+2;break;case i:n=(t-r)/u+4}}return{h:n/=6,s:a,l:h}},toRGB:function(t,r,e){var i,n,a;if(0==r)i=n=a=e;else{var o=function(t,r,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?t+6*(r-t)*e:e<.5?r:e<2/3?t+(r-t)*(2/3-e)*6:t},s=e<.5?e*(1+r):e+r-e*r,h=2*e-s;i=o(h,s,t+1/3),n=o(h,s,t),a=o(h,s,t-1/3)}return{r:255*i,g:255*n,b:255*a}},colorTempToRGB:function(t){var r,i;return(t/=100)<=66?(r=255,i=e.min(e.max(99.4708025861*e.log(t)-161.1195681661,0),255)):(r=e.min(e.max(329.698727446*e.pow(t-60,-.1332047592),0),255),i=e.min(e.max(288.1221695283*e.pow(t-60,-.0755148492),0),255)),{r:r,g:i,b:t>=66?255:t<=19?0:e.min(e.max(138.5177312231*e.log(t-10)-305.0447927307,0),255)}},equalizeHistogram:function(t,r){var e=t.length;r||(r=t);for(var i=new Float32Array(256),n=0,a=0;a<e;++a)++i[~~t[a]],++n;var o=i[0];for(a=1;a<256;++a)o=i[a]+=o;var s=255/n;for(a=0;a<e;++a)r[a]=i[~~t[a]]*s;return r},_toWorker:function(t){if(this.worker)return i(t,{data:this.ctx.getImageData(0,0,this.width,this.height).data}),this.worker.postMessage(t),this;n(!1,"No web worker support!")},queue:function(t){if(this.worker)this._queue.push(t);else{var r=this.ctx.getImageData(0,0,this.width,this.height);r.data=t(r.data),this.ctx.putImageData(r,0,0)}return this}}),i(a.prototype,{greyscale:function(t){t=void 0===t?1:e.min(e.max(t,0),1);var r=this;return this.process((function(e,i,n,a){var o=r.luminance(e,i,n);return[o*t+e*(1-t),o*t+i*(1-t),o*t+n*(1-t),a]}))},threshold:function(t){t=t||127;var r=this;return this.process((function(e,i,n,a){var o=r.luminance(e,i,n)>t?255:0;return[o,o,o,a]}))},invert:function(t){return t=void 0===t?1:e.min(e.max(t,0),1),this.process((function(r,e,i,n){return[(255-r)*t+r*(1-t),(255-e)*t+e*(1-t),(255-i)*t+i*(1-t),n]}))},sepia:function(t){return t=void 0===t?1:e.min(e.max(t,0),1),this.process((function(r,e,i,n){return[(.393*r+.769*e+.189*i)*t+r*(1-t),(.349*r+.686*e+.168*i)*t+e*(1-t),(.272*r+.534*e+.131*i)*t+i*(1-t),n]}))},hdr:function(){var t=function(t){return t>0&&t<=127?t=e.sin(e.PI*(90-t/4)/180)*t:t>127&&(t=e.sin(e.PI*(90-(255-t)/4)/180)*t),t};return this.process((function(r,e,i,n){return[t(r),t(e),t(i),n]}))}}),i(a.prototype,{noise:function(t,r){return n(t>=0,"Noise amount must be a positive number."),r=r||!1,this.process((function(i,n,a,o){var s=-t/2+e.random()*t*2;return[i+s,n+s,a+s,r?o+s:o]}))},glow:function(t){var r=this;return this.blur(t),this.queue((function(t){for(var e=r.ctx.getImageData(0,0,r.width,r.height),i=0;i<t.length;i+=4)t[i]=255-(255-t[i])*(255-e.data[i])/255,t[i+1]=255-(255-t[i+1])*(255-e.data[i+1])/255,t[i+2]=255-(255-t[i+2])*(255-e.data[i+2])/255,t[i+3]=255-(255-t[i+3])*(255-e.data[i+3])/255;return t}))},colorMatrix:function(t){return this.process((function(r,e,i,n){return[r*t[0]+e*t[1]+i*t[2]+n*t[3]+255*t[20],r*t[5]+e*t[6]+i*t[7]+n*t[8]+255*t[21],r*t[10]+e*t[11]+i*t[12]+n*t[13]+255*t[22],r*t[15]+e*t[16]+i*t[17]+n*t[18]+255*t[23]]}))},equalize:function(){var t=this,r=new Uint8ClampedArray(this.width*this.height),e=0;return this.process((function(i,n,a,o){return r[e]=t.luminance(i,n,a),e++,[i,n,a,o]})),this.equalizeHistogram(r),e=0,this.process((function(i,n,a,o){var s=t.toHSL(i,n,a);s.l=r[e]/255,e++;var h=t.toRGB(s.h,s.s,s.l);return[h.r,h.g,h.b,o]}))},tv:function(){return this.process((function(t,r,i,n,a,o){var s=80*e.sin(o);return[t-s,r-s,i-s,n]})),this.noise(50)}}),i(a.prototype,{hue:function(t,r){n(void 0!==t,"Hue must be specified.");var e=this;return r=r||!1,this.process((function(i,n,a,o){var s=e.toHSL(i,n,a);s.h=r?t/360:s.h+t/360;var h=e.toRGB(s.h,s.s,s.l);return[h.r,h.g,h.b,o]}))},saturation:function(t,r){n(void 0!==t,"Saturation must be specified.");var i=this;return r=r||!1,this.process((function(n,a,o,s){var h=i.toHSL(n,a,o);h.s=e.min(e.max(r?t:h.s+t,0),1);var u=i.toRGB(h.h,h.s,h.l);return[u.r,u.g,u.b,s]}))},brightness:function(t){return n(void 0!==t,"Brightness must be set"),this.process((function(r,e,i,n){return[r+t,e+t,i+t,n]}))},contrast:function(t){return n(void 0!==t,"Contrast level must be set."),t=e.pow((t+100)/100,2),this.process((function(r,e,i,n){return[255*((r/255-.5)*t+.5),255*((e/255-.5)*t+.5),255*((i/255-.5)*t+.5),n]}))},gamma:function(t){return n(void 0!==t,"Gamma level must be set."),this.process((function(r,e,i,n){return[r*t,e*t,i*t,n]}))},gammaRGB:function(t,r,e){return n(void 0!==t&&void 0!==r&&void 0!==e,"Gamma level must be set."),this.process((function(i,n,a,o){return[i*t,n*r,a*e,o]}))},vibrance:function(t){return n(void 0!==t,"Vibrance level must be set."),t*=-1,this.process((function(r,i,n,a){var o=e.max(r,i,n),s=2*e.abs(o-(r+i+n)/3)/255*t/100;return r!==o&&(r+=(o-r)*s),i!==o&&(i+=(o-i)*s),n!==o&&(n+=(o-n)*s),[r,i,n,a]}))},whiteBalance:function(t){var r=this.colorTempToRGB(t);return this.process((function(t,e,i,n){return[t*(255/r.r),e*(255/r.g),i*(255/r.b),n]}))}}),i(a.prototype,{convolute:function(t,r,i){if(n(void 0!==t,"Convolution matrix must be set."),n(void 0!==r,"Offset must be set."),i=i||!0,this.worker)this._toWorker({type:"convolute",matrix:t,offset:r,opaque:i});else{for(var a=this.ctx.getImageData(0,0,this.width,this.height),o=e.round(e.sqrt(t.length)),s=e.floor(o/2),h=a.data,u=a.width,c=a.height,f=u,d=this.createImageData(f,p=c),l=d.data,x=i?1:0,v=0;v<p;v++)for(var g=0;g<f;g++){for(var p=v,y=g,w=4*(v*f+g),m=0,b=0,C=0,A=0,I=0;I<o;I++)for(var M=0;M<o;M++){var F=p+I-s,k=y+M-s;if(F>=0&&F<c&&k>=0&&k<u){var R=4*(F*u+k),D=t[I*o+M];m+=h[R]*D,b+=h[R+1]*D,C+=h[R+2]*D,A+=h[R+3]*D}}l[w]=r+m,l[w+1]=r+b,l[w+2]=r+C,l[w+3]=A+x*(255-A)}this.ctx.clearRect(0,0,this.width,this.height),this.ctx.putImageData(d,0,0)}return this},blur:function(t){n(void 0!==t,"Blur radius must be set.");var r=t*t,e=1/r,i=[];if(r<4)return this;for(;r--;)i.push(e);return this.convolute(i,0,!1)},sharpen:function(){return this.convolute([0,-1,0,-1,5,-1,0,-1,0],0,!1)},emboss:function(){return this.convolute([2,0,0,0,-1,0,0,0,-1],127,!1)},findEdges:function(){return this.convolute([-1,0,1,-2,0,2,-1,0,1],0,!1)}}),t.CanvasEffects=a}(window);var CanvasImage=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(t){this.context.putImageData(t,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(window.colorThief=new ColorThief,ColorThief.prototype.getColor=function(t,r){return this.getPalette(t,5,r)[0]},ColorThief.prototype.getPalette=function(t,r,e){(void 0===r||r<2||r>256)&&(r=10),(void 0===e||e<1)&&(e=10);for(var i,n=new CanvasImage(t),a=n.getImageData().data,o=n.getPixelCount(),s=[],h=0;h<o;h+=e)a[3+(i=4*h)]>=125&&s.push([a[i+0],a[i+1],a[i+2]]);var u=MMCQ.quantize(s,r),c=u?u.palette():null;return n.removeCanvas(),c},ColorThief.prototype.getColorFromUrl=function(t,r,e,i){sourceImage=document.createElement("img");var n=this;sourceImage.addEventListener("load",(function(){var t=n.getPalette(sourceImage,e,i);r(t)})),sourceImage.src=t},ColorThief.prototype.getImageData=function(t,r){xhr=new XMLHttpRequest,xhr.open("GET",t,!0),xhr.responseType="arraybuffer",xhr.onload=function(t){if(200==this.status){uInt8Array=new Uint8Array(this.response),e=uInt8Array.length,binaryString=new Array(e);for(var e=0;e<uInt8Array.length;e++)binaryString[e]=String.fromCharCode(uInt8Array[e]);data=binaryString.join(""),base64=window.btoa(data),r("data:image/png;base64,"+base64)}},xhr.send()},ColorThief.prototype.getColorAsync=function(t,r,e){var i=this;this.getImageData(t,(function(t){sourceImage=document.createElement("img"),sourceImage.addEventListener("load",(function(){var t=i.getPalette(sourceImage,5,e);r(t[0],this)})),sourceImage.src=t}))},!pv)var pv={map:function(t,r){var e={};return r?t.map((function(t,i){return e.index=i,r.call(e,t)})):t.slice()},naturalOrder:function(t,r){return t<r?-1:t>r?1:0},sum:function(t,r){var e={};return t.reduce(r?function(t,i,n){return e.index=n,t+r.call(e,i)}:function(t,r){return t+r},0)},max:function(t,r){return Math.max.apply(null,r?pv.map(t,r):t)}};var MMCQ=function(){function t(t,r,e){return(t<<10)+(r<<5)+e}function r(t){var r=[],e=!1;function i(){r.sort(t),e=!0}return{push:function(t){r.push(t),e=!1},peek:function(t){return e||i(),void 0===t&&(t=r.length-1),r[t]},pop:function(){return e||i(),r.pop()},size:function(){return r.length},map:function(t){return r.map(t)},debug:function(){return e||i(),r}}}function e(t,r,e,i,n,a,o){this.r1=t,this.r2=r,this.g1=e,this.g2=i,this.b1=n,this.b2=a,this.histo=o}function i(){this.vboxes=new r((function(t,r){return pv.naturalOrder(t.vbox.count()*t.vbox.volume(),r.vbox.count()*r.vbox.volume())}))}function n(r,e){if(e.count()){var i=e.r2-e.r1+1,n=e.g2-e.g1+1,a=pv.max([i,n,e.b2-e.b1+1]);if(1==e.count())return[e.copy()];var o,s,h,u,c=0,f=[],d=[];if(a==i)for(o=e.r1;o<=e.r2;o++){for(u=0,s=e.g1;s<=e.g2;s++)for(h=e.b1;h<=e.b2;h++)u+=r[t(o,s,h)]||0;f[o]=c+=u}else if(a==n)for(o=e.g1;o<=e.g2;o++){for(u=0,s=e.r1;s<=e.r2;s++)for(h=e.b1;h<=e.b2;h++)u+=r[t(s,o,h)]||0;f[o]=c+=u}else for(o=e.b1;o<=e.b2;o++){for(u=0,s=e.r1;s<=e.r2;s++)for(h=e.g1;h<=e.g2;h++)u+=r[t(s,h,o)]||0;f[o]=c+=u}return f.forEach((function(t,r){d[r]=c-t})),function(t){var r,i,n,a,s,h=t+"1",u=t+"2",l=0;for(o=e[h];o<=e[u];o++)if(f[o]>c/2){for(n=e.copy(),a=e.copy(),s=(r=o-e[h])<=(i=e[u]-o)?Math.min(e[u]-1,~~(o+i/2)):Math.max(e[h],~~(o-1-r/2));!f[s];)s++;for(l=d[s];!l&&f[s-1];)l=d[--s];return n[u]=s,a[h]=n[u]+1,[n,a]}}(a==i?"r":a==n?"g":"b")}}return e.prototype={volume:function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(r){var e=this.histo;if(!this._count_set||r){var i,n,a,o=0;for(i=this.r1;i<=this.r2;i++)for(n=this.g1;n<=this.g2;n++)for(a=this.b1;a<=this.b2;a++)o+=e[t(i,n,a)]||0;this._count=o,this._count_set=!0}return this._count},copy:function(){return new e(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(r){var e=this.histo;if(!this._avg||r){var i,n,a,o,s=0,h=0,u=0,c=0;for(n=this.r1;n<=this.r2;n++)for(a=this.g1;a<=this.g2;a++)for(o=this.b1;o<=this.b2;o++)s+=i=e[t(n,a,o)]||0,h+=i*(n+.5)*8,u+=i*(a+.5)*8,c+=i*(o+.5)*8;this._avg=s?[~~(h/s),~~(u/s),~~(c/s)]:[~~(8*(this.r1+this.r2+1)/2),~~(8*(this.g1+this.g2+1)/2),~~(8*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(t){var r=t[0]>>3;return gval=t[1]>>3,bval=t[2]>>3,r>=this.r1&&r<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},i.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map((function(t){return t.color}))},size:function(){return this.vboxes.size()},map:function(t){for(var r=this.vboxes,e=0;e<r.size();e++)if(r.peek(e).vbox.contains(t))return r.peek(e).color;return this.nearest(t)},nearest:function(t){for(var r,e,i,n=this.vboxes,a=0;a<n.size();a++)((e=Math.sqrt(Math.pow(t[0]-n.peek(a).color[0],2)+Math.pow(t[1]-n.peek(a).color[1],2)+Math.pow(t[2]-n.peek(a).color[2],2)))<r||void 0===r)&&(r=e,i=n.peek(a).color);return i},forcebw:function(){var t=this.vboxes;t.sort((function(t,r){return pv.naturalOrder(pv.sum(t.color),pv.sum(r.color))}));var r=t[0].color;r[0]<5&&r[1]<5&&r[2]<5&&(t[0].color=[0,0,0]);var e=t.length-1,i=t[e].color;i[0]>=255&&i[1]>=255&&i[2]>=255&&(t[e].color=[255,255,255])}},{quantize:function(a,o){if(!a.length||o<2||o>256)return!1;var s=function(r){var e,i=new Array(32768);return r.forEach((function(r){e=t(r[0]>>3,r[1]>>3,r[2]>>3),i[e]=(i[e]||0)+1})),i}(a);s.forEach((function(){}));var h=function(t,r){var i,n,a,o=1e6,s=0,h=1e6,u=0,c=1e6,f=0;return t.forEach((function(t){(i=t[0]>>3)<o?o=i:i>s&&(s=i),(n=t[1]>>3)<h?h=n:n>u&&(u=n),(a=t[2]>>3)<c?c=a:a>f&&(f=a)})),new e(o,s,h,u,c,f,r)}(a,s),u=new r((function(t,r){return pv.naturalOrder(t.count(),r.count())}));function c(t,r){for(var e,i=1,a=0;a<1e3;)if((e=t.pop()).count()){var o=n(s,e),h=o[0],u=o[1];if(!h)return;if(t.push(h),u&&(t.push(u),i++),i>=r)return;if(a++>1e3)return}else t.push(e),a++}u.push(h),c(u,.75*o);for(var f=new r((function(t,r){return pv.naturalOrder(t.count()*t.volume(),r.count()*r.volume())}));u.size();)f.push(u.pop());c(f,o-f.size());for(var d=new i;f.size();)d.push(f.pop());return d}}}();window.Potrace=function(){function t(t,r){this.x=t,this.y=r}function r(t,r){this.w=t,this.h=r,this.size=t*r,this.arraybuffer=new ArrayBuffer(this.size),this.data=new Int8Array(this.arraybuffer)}function e(){this.area=0,this.len=0,this.curve={},this.pt=[],this.minX=1e5,this.minY=1e5,this.maxX=-1,this.maxY=-1}function i(t){this.n=t,this.tag=new Array(t),this.c=new Array(3*t),this.alphaCurve=0,this.vertex=new Array(t),this.alpha=new Array(t),this.alpha0=new Array(t),this.beta=new Array(t)}function n(){function r(){this.data=[0,0,0,0,0,0,0,0,0]}function e(t,r,e,i,n){this.x=t,this.y=r,this.xy=e,this.x2=i,this.y2=n}function n(t,r){return t>=r?t%r:t>=0?t:r-1-(-1-t)%r}function a(t,r){return t.x*r.y-t.y*r.x}function o(t,r,e){return t<=e?t<=r&&r<e:t<=r||r<e}function s(t){return t>0?1:t<0?-1:0}function h(t,r){var e,i,n,a=new Array(3);for(a[0]=r.x,a[1]=r.y,a[2]=1,n=0,e=0;e<3;e++)for(i=0;i<3;i++)n+=a[e]*t.at(e,i)*a[i];return n}function u(r,e,i){var n=new t;return n.x=e.x+r*(i.x-e.x),n.y=e.y+r*(i.y-e.y),n}function c(r,e){var i,n,a,o=(i=r,n=e,(a=new t).y=s(n.x-i.x),a.x=-s(n.y-i.y),a);return o.y*(e.x-r.x)-o.x*(e.y-r.y)}function l(t,r,e){return(r.x-t.x)*(e.y-t.y)-(e.x-t.x)*(r.y-t.y)}function x(t,r,e,i){return(r.x-t.x)*(i.y-e.y)-(i.x-e.x)*(r.y-t.y)}function v(t,r,e){return(r.x-t.x)*(e.x-t.x)+(r.y-t.y)*(e.y-t.y)}function g(t,r){return Math.sqrt((t.x-r.x)*(t.x-r.x)+(t.y-r.y)*(t.y-r.y))}function p(r,e,i,n,a){var o=1-r,s=new t;return s.x=o*o*o*e.x+o*o*r*3*i.x+r*r*o*3*n.x+r*r*r*a.x,s.y=o*o*o*e.y+o*o*r*3*i.y+r*r*o*3*n.y+r*r*r*a.y,s}function y(t,r,e,i,n,a){var o,s,h,u,c,f,d,l;return c=(u=-2*(o=x(t,r,n,a))+2*(s=x(r,e,n,a)))*u-4*(h=o-2*s+x(e,i,n,a))*o,0===h||c<0?-1:(l=(-u-(f=Math.sqrt(c)))/(2*h),(d=(-u+f)/(2*h))>=0&&d<=1?d:l>=0&&l<=1?l:-1)}r.prototype.at=function(t,r){return this.data[3*t+r]};for(var w=0;w<f.length;w++){var m=f[w];!function(t){var r,i,n;t.x0=t.pt[0].x,t.y0=t.pt[0].y,t.sums=[];var a=t.sums;for(a.push(new e(0,0,0,0,0)),r=0;r<t.len;r++)a.push(new e(a[r].x+(i=t.pt[r].x-t.x0),a[r].y+(n=t.pt[r].y-t.y0),a[r].xy+i*n,a[r].x2+i*i,a[r].y2+n*n))}(m),function(r){var e=r.len,i=r.pt,h=new Array(e),u=new Array(e),c=new Array(4);r.lon=new Array(e);var f,d,l,x,v,g,p,y,w=[new t,new t],m=new t,b=new t,C=new t,A=0;for(d=e-1;d>=0;d--)i[d].x!=i[A].x&&i[d].y!=i[A].y&&(A=d+1),u[d]=A;for(d=e-1;d>=0;d--){for(c[0]=c[1]=c[2]=c[3]=0,c[(3+3*(i[n(d+1,e)].x-i[d].x)+(i[n(d+1,e)].y-i[d].y))/2]++,w[0].x=0,w[0].y=0,w[1].x=0,w[1].y=0,A=u[d],x=d;;){if(f=0,c[(3+3*s(i[A].x-i[x].x)+s(i[A].y-i[x].y))/2]++,c[0]&&c[1]&&c[2]&&c[3]){h[d]=x,f=1;break}if(m.x=i[A].x-i[d].x,m.y=i[A].y-i[d].y,a(w[0],m)<0||a(w[1],m)>0)break;if(Math.abs(m.x)<=1&&Math.abs(m.y)<=1||(b.x=m.x+(m.y>=0&&(m.y>0||m.x<0)?1:-1),b.y=m.y+(m.x<=0&&(m.x<0||m.y<0)?1:-1),a(w[0],b)>=0&&(w[0].x=b.x,w[0].y=b.y),b.x=m.x+(m.y<=0&&(m.y<0||m.x<0)?1:-1),b.y=m.y+(m.x>=0&&(m.x>0||m.y<0)?1:-1),a(w[1],b)<=0&&(w[1].x=b.x,w[1].y=b.y)),!o(A=u[x=A],d,x))break}0===f&&(C.x=s(i[A].x-i[x].x),C.y=s(i[A].y-i[x].y),m.x=i[x].x-i[d].x,m.y=i[x].y-i[d].y,v=a(w[0],m),g=a(w[0],C),p=a(w[1],m),y=a(w[1],C),l=1e7,g<0&&(l=Math.floor(v/-g)),y>0&&(l=Math.min(l,Math.floor(-p/y))),h[d]=n(x+l,e))}for(r.lon[e-1]=l=h[e-1],d=e-2;d>=0;d--)o(d+1,h[d],l)&&(l=h[d]),r.lon[d]=l;for(d=e-1;o(n(d+1,e),l,r.lon[d]);d--)r.lon[d]=l}(m),function(t){var r,e,i,a,o,s,h,u,c,f,d,l,x,v,g,p,y,w,m,b,C,A,I,M,F,k=t.len,R=new Array(k+1),D=new Array(k+1),E=new Array(k),S=new Array(k+1),G=new Array(k+1),U=new Array(k+1);for(r=0;r<k;r++)(h=n(t.lon[n(r-1,k)]-1,k))==r&&(h=n(r+1,k)),E[r]=h<r?k:h;for(e=1,r=0;r<k;r++)for(;e<=E[r];)S[e]=r,e++;for(r=0,e=0;r<k;e++)G[e]=r,r=E[r];for(G[e]=k,r=k,e=i=e;e>0;e--)U[e]=r,r=S[r];for(U[0]=0,R[0]=0,e=1;e<=i;e++)for(r=U[e];r<=G[e];r++){for(s=-1,a=G[e-1];a>=S[r];a--)c=a,d=void 0,l=void 0,x=void 0,v=void 0,g=void 0,p=void 0,F=void 0,M=(u=t).sums,F=0,(f=r)>=(A=u.len)&&(f-=A,F=1),0===F?(d=M[f+1].x-M[c].x,l=M[f+1].y-M[c].y,v=M[f+1].x2-M[c].x2,x=M[f+1].xy-M[c].xy,g=M[f+1].y2-M[c].y2,p=f+1-c):(d=M[f+1].x-M[c].x+M[A].x,l=M[f+1].y-M[c].y+M[A].y,v=M[f+1].x2-M[c].x2+M[A].x2,x=M[f+1].xy-M[c].xy+M[A].xy,g=M[f+1].y2-M[c].y2+M[A].y2,p=f+1-c+A),y=(b=-((I=u.pt)[f].y-I[c].y))*b*((v-2*d*(w=(I[c].x+I[f].x)/2-I[0].x))/p+w*w)+2*b*(C=I[f].x-I[c].x)*((x-d*(m=(I[c].y+I[f].y)/2-I[0].y)-l*w)/p+w*m)+C*C*((g-2*l*m)/p+m*m),o=Math.sqrt(y)+R[a],(s<0||o<s)&&(D[r]=a,s=o);R[r]=s}for(t.m=i,t.po=new Array(i),r=k,e=i-1;r>0;e--)t.po[e]=r=D[r]}(m),function(e){var a,o,s,u,c,f,d,l,x,v,g,p,y,w,m,b=e.m,C=e.po,A=e.len,I=e.pt,M=e.x0,F=e.y0,k=new Array(b),R=new Array(b),D=new Array(b),E=new Array(3),S=new t;for(e.curve=new i(b),o=0;o<b;o++)s=n((s=C[n(o+1,b)])-C[o],A)+C[o],k[o]=new t,R[o]=new t,function(t,r,e,i,n){for(var a,o,s,h,u,c,f,d,l,x,v,g=t.len,p=t.sums,y=0;e>=g;)e-=g,y+=1;for(;r>=g;)r-=g,y-=1;for(;e<0;)e+=g,y-=1;for(;r<0;)r+=g,y+=1;o=p[e+1].y-p[r].y+y*p[g].y,s=p[e+1].x2-p[r].x2+y*p[g].x2,h=p[e+1].xy-p[r].xy+y*p[g].xy,u=p[e+1].y2-p[r].y2+y*p[g].y2,i.x=(a=p[e+1].x-p[r].x+y*p[g].x)/(c=e+1-r+y*g),i.y=o/c,f=(s-a*a/c)/c,d=(h-a*o/c)/c,f-=x=(f+(l=(u-o*o/c)/c)+Math.sqrt((f-l)*(f-l)+4*d*d))/2,l-=x,Math.abs(f)>=Math.abs(l)?0!==(v=Math.sqrt(f*f+d*d))&&(n.x=-d/v,n.y=f/v):0!==(v=Math.sqrt(l*l+d*d))&&(n.x=-l/v,n.y=d/v),0===v&&(n.x=n.y=0)}(e,C[o],s,k[o],R[o]);for(o=0;o<b;o++)if(D[o]=new r,0==(a=R[o].x*R[o].x+R[o].y*R[o].y))for(s=0;s<3;s++)for(u=0;u<3;u++)D[o].data[3*s+u]=0;else for(E[0]=R[o].y,E[1]=-R[o].x,E[2]=-E[1]*k[o].y-E[0]*k[o].x,c=0;c<3;c++)for(u=0;u<3;u++)D[o].data[3*c+u]=E[c]*E[u]/a;for(o=0;o<b;o++){for(f=new r,d=new t,S.x=I[C[o]].x-M,S.y=I[C[o]].y-F,s=n(o-1,b),c=0;c<3;c++)for(u=0;u<3;u++)f.data[3*c+u]=D[s].at(c,u)+D[o].at(c,u);for(;;){if(0!=(v=f.at(0,0)*f.at(1,1)-f.at(0,1)*f.at(1,0))){d.x=(-f.at(0,2)*f.at(1,1)+f.at(1,2)*f.at(0,1))/v,d.y=(f.at(0,2)*f.at(1,0)-f.at(1,2)*f.at(0,0))/v;break}for(f.at(0,0)>f.at(1,1)?(E[0]=-f.at(0,1),E[1]=f.at(0,0)):f.at(1,1)?(E[0]=-f.at(1,1),E[1]=f.at(1,0)):(E[0]=1,E[1]=0),a=E[0]*E[0]+E[1]*E[1],E[2]=-E[1]*S.y-E[0]*S.x,c=0;c<3;c++)for(u=0;u<3;u++)f.data[3*c+u]+=E[c]*E[u]/a}if(l=Math.abs(d.x-S.x),x=Math.abs(d.y-S.y),l<=.5&&x<=.5)e.curve.vertex[o]=new t(d.x+M,d.y+F);else{if(g=h(f,S),y=S.x,w=S.y,0!==f.at(0,0))for(m=0;m<2;m++)d.y=S.y-.5+m,d.x=-(f.at(0,1)*d.y+f.at(0,2))/f.at(0,0),l=Math.abs(d.x-S.x),p=h(f,d),l<=.5&&p<g&&(g=p,y=d.x,w=d.y);if(0!==f.at(1,1))for(m=0;m<2;m++)d.x=S.x-.5+m,d.y=-(f.at(1,0)*d.x+f.at(1,2))/f.at(1,1),x=Math.abs(d.y-S.y),p=h(f,d),x<=.5&&p<g&&(g=p,y=d.x,w=d.y);for(c=0;c<2;c++)for(u=0;u<2;u++)d.x=S.x-.5+c,d.y=S.y-.5+u,(p=h(f,d))<g&&(g=p,y=d.x,w=d.y);e.curve.vertex[o]=new t(y+M,w+F)}}}(m),"-"===m.sign&&function(t){var r,e,i,n=m.curve,a=n.vertex;for(r=0,e=n.n-1;r<e;r++,e--)i=a[r],a[r]=a[e],a[e]=i}(),function(t){var r,e,i,a,o,s,h,f,x,v=t.curve.n,g=t.curve;for(r=0;r<v;r++)e=n(r+1,v),i=n(r+2,v),x=u(.5,g.vertex[i],g.vertex[e]),0!==(o=c(g.vertex[r],g.vertex[i]))?(a=l(g.vertex[r],g.vertex[e],g.vertex[i])/o,s=(a=Math.abs(a))>1?1-1/a:0,s/=.75):s=4/3,g.alpha0[e]=s,s>=d.alphamax?(g.tag[e]="CORNER",g.c[3*e+1]=g.vertex[e],g.c[3*e+2]=x):(s<.55?s=.55:s>1&&(s=1),h=u(.5+.5*s,g.vertex[r],g.vertex[e]),f=u(.5+.5*s,g.vertex[i],g.vertex[e]),g.tag[e]="CURVE",g.c[3*e+0]=h,g.c[3*e+1]=f,g.c[3*e+2]=x),g.alpha[e]=s,g.beta[e]=.5;g.alphacurve=1}(m),d.optcurve&&function(r){function e(){this.pen=0,this.c=[new t,new t],this.t=0,this.s=0,this.alpha=0}var a,o,h,c,f,w,m,b,C,A,I=r.curve,M=I.n,F=I.vertex,k=new Array(M+1),R=new Array(M+1),D=new Array(M+1),E=new Array(M+1),S=new e,G=new Array(M),U=new Array(M+1);for(o=0;o<M;o++)G[o]="CURVE"==I.tag[o]?s(l(F[n(o-1,M)],F[o],F[n(o+1,M)])):0;for(w=0,U[0]=0,c=I.vertex[0],o=0;o<M;o++)f=n(o+1,M),"CURVE"==I.tag[f]&&(w+=.3*(m=I.alpha[f])*(4-m)*l(I.c[3*o+2],F[f],I.c[3*f+2])/2,w+=l(c,I.c[3*o+2],I.c[3*f+2])/2),U[o+1]=w;for(k[0]=-1,R[0]=0,D[0]=0,h=1;h<=M;h++)for(k[h]=h-1,R[h]=R[h-1],D[h]=D[h-1]+1,o=h-2;o>=0&&!function(t,r,e,i,a,o,h){var c,f,d,w,m,b,C,A,I,M,F,k,R,D,E,S,G,U,q,L,P,z,O,_,B,T,H=t.curve.n,V=t.curve,X=V.vertex;if(r==e)return 1;if(c=r,m=n(r+1,H),0===(w=o[f=n(c+1,H)]))return 1;for(A=g(X[r],X[m]),c=f;c!=e;c=f){if(f=n(c+1,H),d=n(c+2,H),o[f]!=w)return 1;if(s(x(X[r],X[m],X[f],X[d]))!=w)return 1;if(((_=X[m]).x-(O=X[r]).x)*((T=X[d]).x-(B=X[f]).x)+(_.y-O.y)*(T.y-B.y)<A*g(X[f],X[d])*-.999847695156)return 1}if(F=V.c[3*n(r,H)+2].copy(),k=X[n(r+1,H)].copy(),R=X[n(e,H)].copy(),D=V.c[3*n(e,H)+2].copy(),b=h[e]-h[r],b-=l(X[0],V.c[3*r+2],V.c[3*e+2])/2,r>=e&&(b+=h[H]),G=l(F,k,R),U=l(F,k,D),L=G+(q=l(F,R,D))-U,U==G)return 1;if(P=U/(U-G),0==(S=U*(z=q/(q-L))/2))return 1;for(C=2-Math.sqrt(4-b/S/.3),i.c[0]=u(z*C,F,k),i.c[1]=u(P*C,D,R),i.alpha=C,i.t=z,i.s=P,k=i.c[0].copy(),R=i.c[1].copy(),i.pen=0,c=n(r+1,H);c!=e;c=f){if(f=n(c+1,H),(z=y(F,k,R,D,X[c],X[f]))<-.5)return 1;if(E=p(z,F,k,R,D),0===(A=g(X[c],X[f])))return 1;if(I=l(X[c],X[f],E)/A,Math.abs(I)>a)return 1;if(v(X[c],X[f],E)<0||v(X[f],X[c],E)<0)return 1;i.pen+=I*I}for(c=r;c!=e;c=f){if(f=n(c+1,H),(z=y(F,k,R,D,V.c[3*c+2],V.c[3*f+2]))<-.5)return 1;if(E=p(z,F,k,R,D),0===(A=g(V.c[3*c+2],V.c[3*f+2])))return 1;if(I=l(V.c[3*c+2],V.c[3*f+2],E)/A,M=l(V.c[3*c+2],V.c[3*f+2],X[f])/A,(M*=.75*V.alpha[f])<0&&(I=-I,M=-M),I<M-a)return 1;I<M&&(i.pen+=(I-M)*(I-M))}return 0}(r,o,n(h,M),S,d.opttolerance,G,U);o--)(D[h]>D[o]+1||D[h]==D[o]+1&&R[h]>R[o]+S.pen)&&(k[h]=o,R[h]=R[o]+S.pen,D[h]=D[o]+1,E[h]=S,S=new e);for(b=new i(a=D[M]),C=new Array(a),A=new Array(a),h=M,o=a-1;o>=0;o--)k[h]==h-1?(b.tag[o]=I.tag[n(h,M)],b.c[3*o+0]=I.c[3*n(h,M)+0],b.c[3*o+1]=I.c[3*n(h,M)+1],b.c[3*o+2]=I.c[3*n(h,M)+2],b.vertex[o]=I.vertex[n(h,M)],b.alpha[o]=I.alpha[n(h,M)],b.alpha0[o]=I.alpha0[n(h,M)],b.beta[o]=I.beta[n(h,M)],C[o]=A[o]=1):(b.tag[o]="CURVE",b.c[3*o+0]=E[h].c[0],b.c[3*o+1]=E[h].c[1],b.c[3*o+2]=I.c[3*n(h,M)+2],b.vertex[o]=u(E[h].s,I.c[3*n(h,M)+2],F[n(h,M)]),b.alpha[o]=E[h].alpha,b.alpha0[o]=E[h].alpha,C[o]=E[h].s,A[o]=E[h].t),h=k[h];for(o=0;o<a;o++)f=n(o+1,a),b.beta[o]=C[o]/(C[o]+A[f]);b.alphacurve=1,r.curve=b}(m)}}function a(){u=null,f=[],o=null,d.isReady=!1}t.prototype.copy=function(){return new t(this.x,this.y)},r.prototype.at=function(t,r){return t>=0&&t<this.w&&r>=0&&r<this.h&&1===this.data[this.w*r+t]},r.prototype.index=function(r){var e=new t;return e.y=Math.floor(r/this.w),e.x=r-e.y*this.w,e},r.prototype.flip=function(t,r){this.data[this.w*r+t]=this.at(t,r)?0:1},r.prototype.copy=function(){var t,e=new r(this.w,this.h);for(t=0;t<this.size;t++)e.data[t]=this.data[t];return e};var o,s=document.createElement("img"),h=document.createElement("canvas"),u=null,c=800,f=[],d={isReady:!1,turnpolicy:"minority",turdsize:5,optcurve:!0,alphamax:1,opttolerance:1};return s.onload=function(){(function(){var t=s.width/s.height;h.width=s.width,h.height=s.height,h.width>c&&(h.width=c,h.height=c/t),h.height>c&&(h.height=c,h.width=c*t);var r=h.getContext("2d");r.fillStyle="#ffffff",r.fillRect(0,0,h.width,h.height),r.drawImage(s,0,0,h.width,h.height)})(),function(){var t=h.getContext("2d");u=new r(h.width,h.height);var e,i,n=t.getImageData(0,0,u.w,u.h),a=n.data.length;for(e=0,i=0;e<a;e+=4,i++)u.data[i]=.2126*n.data[e]+.7153*n.data[e+1]+.0721*n.data[e+2]<128?1:0;d.isReady=!0}()},{loadImageFromFile:function(t){d.isReady&&a(),s.file=t;var r,e=new FileReader;e.onload=(r=s,function(t){r.src=t.target.result}),e.readAsDataURL(t)},loadImageFromUrl:function(t){d.isReady&&a(),s.src=t},setParameter:function(t){var r;for(r in t)t.hasOwnProperty(r)&&(d[r]=t[r])},loadFromCanvas:function(t){d.isReady&&a(),h.width=t.width,h.height=t.height;var e=h.getContext("2d");e.clearRect(0,0,h.width,h.height),e.drawImage(t,0,0,h.width,h.height),u=new r(h.width,h.height);var i,n,o=e.getImageData(0,0,u.w,u.h),s=o.data.length;for(i=0,n=0;i<s;i+=4,n++)o.data[i+3]>0&&(u.data[n]=.2126*o.data[i]+.7153*o.data[i+1]+.0721*o.data[i+2]<128?1:0);d.isReady=!0},process:function r(i){i&&(o=i),d.isReady?(function(){function r(t,r){var e,i,a;for(e=2;e<5;e++){for(a=0,i=1-e;i<=e-1;i++)a+=n.at(t+i,r+e-1)?1:-1,a+=n.at(t+e-1,r+i-1)?1:-1,a+=n.at(t+i-1,r-e)?1:-1,a+=n.at(t-e,r+i)?1:-1;if(a>0)return 1;if(a<0)return 0}return 0}for(var i,n=u.copy(),a=new t(0,0);a=function(t){for(var r=n.w*t.y+t.x;r<n.size&&1!==n.data[r];)r++;return r<n.size&&n.index(r)}(a);)(function(t){var r,e,i,a,o,s=t.pt[0].y,h=t.len;for(a=1;a<h;a++)if((r=t.pt[a].y)!==s){for(i=s<r?s:r,e=t.maxX,o=t.pt[a].x;o<e;o++)n.flip(o,i);s=r}})(i=function(i){var a,o=new e,s=i.x,h=i.y,c=0,f=1;for(o.sign=u.at(i.x,i.y)?"+":"-";o.pt.push(new t(s,h)),s>o.maxX&&(o.maxX=s),s<o.minX&&(o.minX=s),h>o.maxY&&(o.maxY=h),h<o.minY&&(o.minY=h),o.len++,h+=f,o.area-=(s+=c)*f,s!==i.x||h!==i.y;){var l=n.at(s+(c+f-1)/2,h+(f-c-1)/2),x=n.at(s+(c-f-1)/2,h+(f+c-1)/2);x&&!l?"right"===d.turnpolicy||"black"===d.turnpolicy&&"+"===o.sign||"white"===d.turnpolicy&&"-"===o.sign||"majority"===d.turnpolicy&&r(s,h)||"minority"===d.turnpolicy&&!r(s,h)?(a=c,c=-f,f=a):(a=c,c=f,f=-a):x?(a=c,c=-f,f=a):l||(a=c,c=f,f=-a)}return o}(a)),i.area>d.turdsize&&f.push(i)}(),n(),o(),o=null):setTimeout((function(){r(i)}),100)},getSVG:function(t,r,e){var i,n,a,o,s=f.length,h='<svg id="svg" version="1.1" width="'+u.w*t+'" height="'+u.h*t+'" xmlns="http://www.w3.org/2000/svg">';for(h+='<path d="',i=0;i<s;i++)h+=function(r){var e,i,n,a,o=r.n,s="M"+(r.c[3*(o-1)+2].x*t).toFixed(3)+" "+(r.c[3*(o-1)+2].y*t).toFixed(3)+" ";for(e=0;e<o;e++)"CURVE"===r.tag[e]?s+=(a=void 0,a="C "+(r.c[3*(n=e)+0].x*t).toFixed(3)+" "+(r.c[3*n+0].y*t).toFixed(3)+",",(a+=(r.c[3*n+1].x*t).toFixed(3)+" "+(r.c[3*n+1].y*t).toFixed(3)+",")+(r.c[3*n+2].x*t).toFixed(3)+" "+(r.c[3*n+2].y*t).toFixed(3)+" "):"CORNER"===r.tag[e]&&(s+="L "+(r.c[3*(i=e)+1].x*t).toFixed(3)+" "+(r.c[3*i+1].y*t).toFixed(3)+" "+(r.c[3*i+2].x*t).toFixed(3)+" "+(r.c[3*i+2].y*t).toFixed(3)+" ");return s}(f[i].curve);return"curve"===r?(n="black",a="none",o=""):(n="none",a=e,o=' fill-rule="evenodd"'),h+'" stroke="'+n+'" fill="'+a+'"'+o+"/></svg>"},getPath:function(t,r,e,i){var n,a,o,s,h=f.length,u="";for(u+='<path d="',n=0;n<h;n++)u+=function(r){var e,i,n,a,o=r.n,s="M"+(r.c[3*(o-1)+2].x*t).toFixed(3)+" "+(r.c[3*(o-1)+2].y*t).toFixed(3)+" ";for(e=0;e<o;e++)"CURVE"===r.tag[e]?s+=(a=void 0,a="C "+(r.c[3*(n=e)+0].x*t).toFixed(3)+" "+(r.c[3*n+0].y*t).toFixed(3)+",",(a+=(r.c[3*n+1].x*t).toFixed(3)+" "+(r.c[3*n+1].y*t).toFixed(3)+",")+(r.c[3*n+2].x*t).toFixed(3)+" "+(r.c[3*n+2].y*t).toFixed(3)+" "):"CORNER"===r.tag[e]&&(s+="L "+(r.c[3*(i=e)+1].x*t).toFixed(3)+" "+(r.c[3*i+1].y*t).toFixed(3)+" "+(r.c[3*i+2].x*t).toFixed(3)+" "+(r.c[3*i+2].y*t).toFixed(3)+" ");return s}(f[n].curve);return"curve"===r?(a="black",o="none",s=""):(a="none",o=e,s=' fill-rule="evenodd"'),u+='" stroke="'+a+'" fill="'+o+'"'+s+"/>",i&&(u=u.replace("<path d",'<path id="'+i+'" d')),u},getPathd:function(t,r,e){var i,n=f.length,a="";for(i=0;i<n;i++)a+=function(r){var e,i,n,a,o=r.n,s="M"+(r.c[3*(o-1)+2].x*t).toFixed(3)+" "+(r.c[3*(o-1)+2].y*t).toFixed(3)+" ";for(e=0;e<o;e++)"CURVE"===r.tag[e]?s+=(a=void 0,a="C "+(r.c[3*(n=e)+0].x*t).toFixed(3)+" "+(r.c[3*n+0].y*t).toFixed(3)+",",(a+=(r.c[3*n+1].x*t).toFixed(3)+" "+(r.c[3*n+1].y*t).toFixed(3)+",")+(r.c[3*n+2].x*t).toFixed(3)+" "+(r.c[3*n+2].y*t).toFixed(3)+" "):"CORNER"===r.tag[e]&&(s+="L "+(r.c[3*(i=e)+1].x*t).toFixed(3)+" "+(r.c[3*i+1].y*t).toFixed(3)+" "+(r.c[3*i+2].x*t).toFixed(3)+" "+(r.c[3*i+2].y*t).toFixed(3)+" ");return s}(f[i].curve);return a},img:s}}(),(function(){function t(t){if(this.method=(t=t||{}).method||2,this.colors=t.colors||256,this.width=1e3,this.height=1e3,this.blur=t.blur||0,this.initColors=t.initColors||4096,this.initDist=t.initDist||.02,this.distIncr=t.distIncr||.01,this.hueGroups=t.hueGroups||1,this.satGroups=t.satGroups||1,this.lumGroups=t.lumGroups||1,this.minHueCols=t.minHueCols||1,this.hueStats=this.minHueCols?new e(this.hueGroups,this.minHueCols):null,this.boxSize=t.boxSize||[64,64],this.boxPxls=t.boxPxls||1,this.palLocked=!1,this.dithKern=t.ditherKern||null,this.dithSerp=t.dithSerp||!1,this.dithDelta=t.dithDelta||0,this.histogram={},this.idxrgb=t.palette?t.palette.slice(0):[],this.idxi32=[],this.i32idx={},this.i32rgb={},this.idxhex=[],this.useCache=!1!==t.useCache,this.cacheFreq=t.cacheFreq||10,this.reIndex=t.reIndex||0==this.idxrgb.length,this.colorDist="manhattan"==t.colorDist?n:i,this.averageRGB={r:255,g:255,b:255},this.idxrgb.length>0){var a=this;this.idxrgb.forEach((function(t,e){var i,n,o=(255<<24|t[2]<<16|t[1]<<8|t[0])>>>0;a.idxi32[e]=o,a.i32idx[o]=e,a.i32rgb[o]=t,a.idxhex[e]=(i=t[1],n=t[2],r(t[0])+r(i)+r(n))}))}}function r(t){var r=t.toString(16);return 1==r.length?"0"+r:r}function e(t,r){this.numGroups=t,this.minCols=r,this.stats={};for(var e=-1;e<t;e++)this.stats[e]={num:0,cols:[]};this.groupsFull=0}function i(t,r){var e=r[0]-t[0],i=r[1]-t[1],n=r[2]-t[2],a=this.averageRGB.r+this.averageRGB.g+this.averageRGB.b;return l||(l=(this.averageRGB.r/a).toFixed(3),x=(this.averageRGB.g/a).toFixed(3),v=(this.averageRGB.b/a).toFixed(3)),d||(d=Math.sqrt(255*l*255+255*x*255+255*v*255)),Math.sqrt(l*e*e+x*i*i+v*n*n)/d}function n(t,r){var e=Math.abs(r[0]-t[0]),i=Math.abs(r[1]-t[1]),n=Math.abs(r[2]-t[2]);return(p*e+y*i+w*n)/m}function a(t,r,e){var i,n,a,o,s,h,u,c,f;if(t/=255,r/=255,e/=255,s=((i=Math.max(t,r,e))+(n=Math.min(t,r,e)))/2,i==n)a=o=0;else{switch(h=i-n,o=s>.5?h/(2-i-n):h/(i+n),i){case t:a=(r-e)/h+(r<e?6:0);break;case r:a=(e-t)/h+2;break;case e:a=(t-r)/h+4}a/=6}return{h:a,s:o,l:(u=t,c=r,f=e,l?Math.sqrt(l*u*u+x*c*c+v*f*f):Math.sqrt(p*u*u+y*c*c+w*f*f))}}function o(t,r){var e=1/r,i=e/2;if(t>=1-i||t<=i)return 0;for(var n=1;n<r;n++){var a=n*e;if(t>=a-i&&t<=a+i)return n}}function s(t){return Object.prototype.toString.call(t).slice(8,-1)}function h(t,r,e){var i,n,a,o,h,c,f,d;switch(e&&(d=e.blur),s(t)){case"HTMLImageElement":window.MAX_VALUE=2400,(i=document.createElement("canvas")).width=t.naturalWidth,i.height=t.naturalHeight;var l=i.width/i.height;i.width<1e3&&(i.width=1e3,i.height=1e3/l),i.height<1e3&&(i.width=1e3*l,i.height=1e3),i.width>window.MAX_VALUE&&(i.width=window.MAX_VALUE,i.height=window.MAX_VALUE/l),i.height>window.MAX_VALUE&&(i.width=window.MAX_VALUE*l,i.height=window.MAX_VALUE),n=i.getContext("2d"),null!=e&&(e.width=i.width,e.height=i.height),n.drawImage(t,0,0,t.naturalWidth,t.naturalHeight,0,0,i.width,i.height),n.filter="blur("+d+"px)",u(n.getImageData(0,0,i.width,i.height)),n.drawImage(t,0,0,i.width,i.height),f=u(n.getImageData(0,0,i.width,i.height));case"Canvas":case"HTMLCanvasElement":i=i||t,n=n||i.getContext("2d");case"CanvasRenderingContext2D":a=(n=n||t).getImageData(0,0,(i=i||n.canvas).width,i.height);case"ImageData":r=(a=a||t).width,o="CanvasPixelArray"==s(a.data)?new Uint8Array(a.data):a.data;case"Array":case"CanvasPixelArray":o=o||new Uint8Array(t);case"Uint8Array":case"Uint8ClampedArray":o=o||t,h=new Uint32Array(o.buffer);case"Uint32Array":h=h||t,o=o||new Uint8Array(h.buffer),c=h.length/(r=r||h.length)}return{can:i,ctx:n,imgd:a,buf8:o,buf32:h,width:r,height:c,avgRGB:f}}function u(t){for(var r=0;(r+=4*I)<t.data.length;)++C,A.r+=t.data[r],A.g+=t.data[r+1],A.b+=t.data[r+2];return A.r=~~(A.r/C),A.g=~~(A.g/C),A.b=~~(A.b/C),C=0,A}var c,f;t.prototype.sample=function(t,r,e,i,n){if(this.palLocked)throw"Cannot sample additional images, palette already assembled.";if(c=h(t,r,this),this.averageRGB=c.avgRGB,i)n(e);else switch(this.method){case 1:this.colorStats1D(c.buf32,n);break;case 2:this.colorStats2D(c.buf32,c.width)}},t.prototype.reduce=function(t,r,e,i){if(this.palLocked||this.buildPal(),i=void 0!==i?i:this.dithSerp,r=r||1,e=e||this.dithKern)o=this.dither(t,e,i);else{var n=h(t,null,this).buf32,a=n.length,o=new Uint32Array(a),s=0;!function t(r){for(;s<a;s++)o[s]=r.nearestColor(n[s]),s+1<a&&s%8e3==0&&setTimeout(t,0)}(this)}if(this.reduceOut32=o,1==r)return new Uint8Array(o.buffer);if(2==r){var u=[];for(a=o.length,s=0;s<a;s++)u[s]=this.i32idx[o[s]];return u}},t.prototype.replaceColor=function(t,r){for(var e=(255<<24)+(r.b<<16)+(r.g<<8)+r.r,i=this.reduceOut32[0],n=0;n<this.reduceOut32.length;n++)this.reduceOut32[n]==i&&(this.reduceOut32[n]=e);return new Uint8Array(this.reduceOut32.buffer)},t.prototype.dither=function(t,r,e){var i={FloydSteinberg:[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]],FalseFloydSteinberg:[[3/8,1,0],[3/8,0,1],[.25,1,1]],Stucki:[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]],Atkinson:[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]],Jarvis:[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]],Burkes:[[.25,1,0],[.125,2,0],[2/32,-2,1],[.125,-1,1],[.25,0,1],[.125,1,1],[2/32,2,1]],Sierra:[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[.125,-1,1],[5/32,0,1],[.125,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]],TwoSierra:[[.25,1,0],[3/16,2,0],[1/16,-2,1],[.125,-1,1],[3/16,0,1],[.125,1,1],[1/16,2,1]],SierraLite:[[.5,1,0],[.25,-1,1],[.25,0,1]]};if(!r||!i[r])throw"Unknown dithering kernel: "+r;for(var n=i[r],a=h(t,null,this),o=a.buf32,s=a.width,u=a.height,c=e?-1:1,f=0;f<u;f++){e&&(c*=-1);for(var d=f*s,l=1==c?0:s-1,x=1==c?s:0;l!==x;l+=c){var v=d+l,g=o[v],p=255&g,y=(65280&g)>>8,w=(16711680&g)>>16,m=this.nearestColor(g),b=255&m,C=(65280&m)>>8,A=(16711680&m)>>16;if(o[v]=255<<24|A<<16|C<<8|b,!(this.dithDelta&&this.colorDist([p,y,w],[b,C,A])<this.dithDelta))for(var I=p-b,M=y-C,F=w-A,k=1==c?0:n.length-1,R=1==c?n.length:0;k!==R;k+=c){var D=n[k][1]*c,E=n[k][2];if(D+l>=0&&D+l<s&&E+f>=0&&E+f<u){var S=n[k][0],G=v+(E*s+D),U=(65280&o[G])>>8,q=(16711680&o[G])>>16,L=Math.max(0,Math.min(255,(255&o[G])+I*S)),P=Math.max(0,Math.min(255,U+M*S)),z=Math.max(0,Math.min(255,q+F*S));o[G]=255<<24|z<<16|P<<8|L}}}}return o},t.prototype.buildPal=function(t){if(!(this.palLocked||this.idxrgb.length>0&&this.idxrgb.length<=this.colors)){var r=this.histogram,e=function(t,r){var e=[];for(var i in t)e.push(i);return b.call(e,(function(r,e){return t[e]-t[r]}))}(r);if(0==e.length)throw"Nothing has been sampled, palette cannot be built.";switch(this.method){case 1:for(var i=this.initColors,n=r[e[i-1]],a=e.slice(0,i),o=i,s=e.length;o<s&&r[e[o]]==n;)a.push(e[o++]);this.hueStats&&this.hueStats.inject(a);break;case 2:a=e}a=a.map((function(t){return+t})),this.reducePal(a),!t&&this.reIndex&&this.sortPal(),this.useCache&&this.cacheHistogram(a),this.palLocked=!0}},t.prototype.palette=function(t,r,e){return e&&(this.histogram=e),this.buildPal(r),t?this.idxrgb:new Uint8Array(new Uint32Array(this.idxi32).buffer)},t.prototype.prunePal=function(t){for(var r,e=0;e<this.idxrgb.length;e++)t[e]||(r=this.idxi32[e],this.idxrgb[e]=null,this.idxi32[e]=null,delete this.i32idx[r]);if(this.reIndex){for(var i=[],n=[],a={},o=(e=0,0);e<this.idxrgb.length;e++)this.idxrgb[e]&&(r=this.idxi32[e],i[o]=this.idxrgb[e],a[r]=o,n[o]=r,o++);this.idxrgb=i,this.idxi32=n,this.i32idx=a}},t.prototype.reducePal=function(t){if(this.idxrgb.length>this.colors){for(var r,e=t.length,i={},n=0,a=!1,o=0;o<e;o++)n!=this.colors||a||(this.prunePal(i),a=!0),r=this.nearestIndex(t[o]),n<this.colors&&!i[r]&&(i[r]=!0,n++);a||(this.prunePal(i),a=!0)}else{var s=t.map((function(t){return[255&t,(65280&t)>>8,(16711680&t)>>16]})),h=e=s.length,u=this.initDist;if(h>this.colors){for(;h>this.colors;){var c=[];for(o=0;o<e;o++){var f=s[o];if(f)for(var d=o+1;d<e;d++){var l=s[d],x=t[d];if(l){var v=this.colorDist(f,l);v<u&&(c.push([d,l,x,v]),delete s[d],h--)}}}u+=h>3*this.colors?this.initDist:this.distIncr}if(h<this.colors){b.call(c,(function(t,r){return r[3]-t[3]}));for(var g=0;h<this.colors;)s[c[g][0]]=c[g][1],h++,g++}}for(e=s.length,o=0;o<e;o++)s[o]&&(this.idxrgb.push(s[o]),this.idxi32.push(t[o]),this.i32idx[t[o]]=this.idxi32.length-1,this.i32rgb[t[o]]=s[o])}},t.prototype.colorStats1D=function(t,r){var e=this.histogram;(f=new Worker("assets/worker.js")).addEventListener("message",(function(t){r(JSON.parse(t.data.histG))}),!1),f.postMessage({buf32:t,col:void 0,histG:e})},t.prototype.colorStats2D=function(t,r){var e=this.boxSize[0],i=this.boxSize[1],n=e*i,a=function(t,r,e,i){for(var n=t%e,a=r%i,o=t-n,s=r-a,h=[],u=0;u<r;u+=i)for(var c=0;c<t;c+=e)h.push({x:c,y:u,w:c==o?n:e,h:u==s?a:i});return h}(r,t.length/r,e,i),o=this.histogram,s=this;a.forEach((function(e){var i,a=Math.max(Math.round(e.w*e.h/n)*s.boxPxls,2),h={};!function(t,r,e){var i=t,n=(i.y+i.h-1)*r+(i.x+i.w-1),a=0,o=r-i.w+1,s=i.y*r+i.x;do{e.call(this,s),s+=++a%i.w==0?o:1}while(s<=n)}(e,r,(function(r){(4278190080&(i=t[r]))>>24!=0&&(s.hueStats&&s.hueStats.check(i),i in o?o[i]++:i in h?++h[i]>=a&&(o[i]=h[i]):h[i]=1)}))})),this.hueStats&&this.hueStats.inject(o)},t.prototype.sortPal=function(){var t=this;this.idxi32.sort((function(r,e){var i=t.idxrgb[t.i32idx[r]],n=t.idxrgb[t.i32idx[e]],s=a(i[0],i[1],i[2]),h=a(n[0],n[1],n[2]),u=i[0]==i[1]&&i[1]==i[2]?-1:o(s.h,t.hueGroups),c=(n[0]==n[1]&&n[1]==n[2]?-1:o(h.h,t.hueGroups))-u;if(c)return-c;var f=+h.l.toFixed(2)-+s.l.toFixed(2);if(f)return-f;var d=+h.s.toFixed(2)-+s.s.toFixed(2);return d?-d:void 0})),this.idxi32.forEach((function(r,e){t.idxrgb[e]=t.i32rgb[r],t.i32idx[r]=e}))},t.prototype.nearestColor=function(t){var r=this.nearestIndex(t);return null===r?0:this.idxi32[r]},t.prototype.nearestIndex=function(t){if((4278190080&t)>>24==0)return null;if(this.useCache&&""+t in this.i32idx)return this.i32idx[t];for(var r,e=100,i=[255&t,(65280&t)>>8,(16711680&t)>>16],n=this.idxrgb.length,a=0;a<n;a++)if(this.idxrgb[a]){var o=this.colorDist(i,this.idxrgb[a]);o<e&&(e=o,r=a)}return r},Array.closest=function(){function t(r,e){return r.length&&e.length?t(r.slice(2),e.slice(2))+Math.abs(parseInt(r.slice(0,2),16)-parseInt(e.slice(0,2),16)):16777215}return function(r,e){return r.sort((function(r,i){return t(r,e)-t(i,e)}))}}(),t.prototype.cacheHistogram=function(t){for(var r=0,e=t[r];r<t.length&&this.histogram[e]>=this.cacheFreq;e=t[r++])this.i32idx[e]=this.nearestIndex(e)},e.prototype.check=function(t){this.groupsFull==this.numGroups+1&&(this.check=function(){});var r=255&t,e=(65280&t)>>8,i=(16711680&t)>>16,n=r==e&&e==i?-1:o(a(r,e,i).h,this.numGroups),s=this.stats[n],h=this.minCols;++s.num>h||(s.num==h&&this.groupsFull++,s.num<=h&&this.stats[n].cols.push(t))},e.prototype.inject=function(t){for(var r=-1;r<this.numGroups;r++)if(this.stats[r].num<=this.minCols)switch(s(t)){case"Array":this.stats[r].cols.forEach((function(r){-1==t.indexOf(r)&&t.push(r)}));break;case"Object":this.stats[r].cols.forEach((function(r){t[r]?t[r]++:t[r]=1}))}};var d,l,x,v,g,p=.299,y=.587,w=.114,m=255*p+255*y+255*w,b="xyzvwtursopqmnklhijfgdeabc"==(g="abcdefghijklmnopqrstuvwxyz").split("").sort((function(t,r){return~~(g.indexOf(r)/2.3)-~~(g.indexOf(t)/2.3)})).join("")?Array.prototype.sort:function(t){var r=s(this[0]);if("Number"==r||"String"==r){for(var e,i={},n=this.length,a=0;a<n;a++)i[e=this[a]]||0===i[e]||(i[e]=a);return this.sort((function(r,e){return t(r,e)||i[r]-i[e]}))}return i=this.map((function(t){return t})),this.sort((function(r,e){return t(r,e)||i.indexOf(r)-i.indexOf(e)}))},C=0,A={r:0,g:0,b:0},I=5;window.RgbQuant=t,"undefined"!=typeof module&&module.exports&&(module.exports=t)}).call(window);